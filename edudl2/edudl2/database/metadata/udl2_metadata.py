from sqlalchemy.schema import MetaData, Sequence, Index
from sqlalchemy import Table, Column, text
from sqlalchemy.types import Text, Boolean, TIMESTAMP, Interval, TIME
from sqlalchemy.types import BigInteger, SmallInteger, String, Float


def generate_udl2_metadata(schema_name=None, bind=None):
    '''
    generate_udl2_metadata function creates a metadata object that contains all udl2 related staging tables.
    '''

    metadata = MetaData(schema=schema_name, bind=bind)

    stg_mock_load = Table('stg_mock_load', metadata,
                          Column('record_sid', BigInteger, primary_key=True),
                          Column('guid_batch', String(256), nullable=False),
                          Column('substr_test', String(256), nullable=False),
                          Column('number_test', String(256), nullable=False),
                          )

    int_mock_load = Table('int_mock_load', metadata,
                          Column('record_sid', BigInteger, primary_key=True),
                          Column('guid_batch', String(256), nullable=False),
                          Column('substr_test', String(256), nullable=False),
                          Column('number_test', String(256), nullable=False),
                          )

    udl_batch = Table('udl_batch', metadata,
                      Column('batch_sid', BigInteger, primary_key=True),
                      Column('guid_batch', String(256), nullable=False),
                      Column('tenant', String(256), nullable=False, server_default=''),
                      Column('input_file', Text, nullable=False, server_default=''),
                      Column('load_type', String(50), nullable=True),
                      Column('working_schema', String(50), nullable=True),
                      Column('udl_phase', String(256), nullable=True),
                      Column('udl_phase_step', String(50), nullable=True),
                      Column('udl_phase_step_status', String(50), nullable=True),
                      Column('error_desc', Text, nullable=True),
                      Column('stack_trace', Text, nullable=True),
                      Column('udl_leaf', Boolean, nullable=True),
                      Column('size_records', BigInteger, nullable=True),
                      Column('size_units', BigInteger, nullable=True),
                      Column('start_timestamp', TIMESTAMP, nullable=True, server_default=text('NOW()')),
                      Column('end_timestamp', TIMESTAMP, nullable=True, server_default=text('NOW()')),
                      Column('duration', Interval, nullable=True),
                      Column('time_for_one_million_records', TIME, nullable=True),
                      Column('records_per_hour', BigInteger, nullable=True),
                      Column('task_id', String(256), nullable=True),
                      Column('task_status_url', String(256), nullable=True),
                      Column('user_sid', BigInteger, nullable=True),
                      Column('user_email', String(256), nullable=True),
                      Column('created_date', TIMESTAMP, nullable=True, server_default=text('NOW()')),
                      Column('mod_date', TIMESTAMP, nullable=False, server_default=text('NOW()')),
                      )

    stg_sbac_stu_reg = Table('stg_sbac_stu_reg', metadata,
                             Column('record_sid', BigInteger, primary_key=True),
                             Column('src_file_rec_num', BigInteger, nullable=False),
                             Column('name_state', String(256), nullable=True),
                             Column('code_state', String(256), nullable=True),
                             Column('guid_district', String(256), nullable=True),
                             Column('name_district', String(256), nullable=True),
                             Column('guid_school', String(256), nullable=True),
                             Column('name_school', String(256), nullable=True),
                             Column('guid_student', String(256), nullable=True),
                             Column('external_ssid_student', String(256), nullable=True),
                             Column('name_student_first', String(256), nullable=True),
                             Column('name_student_middle', String(256), nullable=True),
                             Column('name_student_last', String(256), nullable=True),
                             Column('birthdate_student', String(256), nullable=True),
                             Column('sex_student', String(256), nullable=True),
                             Column('grade_enrolled', String(256), nullable=True),
                             Column('dmg_eth_hsp', String(256), nullable=True),
                             Column('dmg_eth_ami', String(256), nullable=True),
                             Column('dmg_eth_asn', String(256), nullable=True),
                             Column('dmg_eth_blk', String(256), nullable=True),
                             Column('dmg_eth_pcf', String(256), nullable=True),
                             Column('dmg_eth_wht', String(256), nullable=True),
                             Column('dmg_prg_iep', String(256), nullable=True),
                             Column('dmg_prg_lep', String(256), nullable=True),
                             Column('dmg_prg_504', String(256), nullable=True),
                             Column('dmg_sts_ecd', String(256), nullable=True),
                             Column('dmg_sts_mig', String(256), nullable=True),
                             Column('dmg_multi_race', String(256), nullable=True),
                             Column('code_confirm', String(256), nullable=True),
                             Column('code_language', String(256), nullable=True),
                             Column('eng_prof_lvl', String(256), nullable=True),
                             Column('us_school_entry_date', String(256), nullable=True),
                             Column('lep_entry_date', String(256), nullable=True),
                             Column('lep_exit_date', String(256), nullable=True),
                             Column('t3_program_type', String(256), nullable=True),
                             Column('prim_disability_type', String(256), nullable=True),
                             Column('created_date', TIMESTAMP(timezone=True), nullable=False, server_default=text('NOW()')),
                             Column('guid_batch', String(256), nullable=False),
                             )
    Index('stg_sbac_stu_reg_guid_batchx', stg_sbac_stu_reg.c.guid_batch, unique=False)

    stg_sbac_asmt_outcome = Table('stg_sbac_asmt_outcome', metadata,
                                  Column('record_sid', BigInteger, primary_key=True),
                                  Column('Op', String(1), nullable=True, server_default='C'),
                                  Column('src_file_rec_num', BigInteger, nullable=False),
                                  Column('AssessmentGuid', String(256), nullable=True),
                                  Column('AssessmentSessionLocationId', String(256), nullable=True),
                                  Column('AssessmentSessionLocation', String(256), nullable=True),
                                  Column('AssessmentLevelForWhichDesigned', String(256), nullable=True),
                                  Column('StateName', String(256), nullable=True),
                                  Column('StateAbbreviation', String(256), nullable=True),
                                  Column('ResponsibleDistrictIdentifier', String(256), nullable=True),
                                  Column('OrganizationName', String(256), nullable=True),
                                  Column('ResponsibleSchoolIdentifier', String(256), nullable=True),
                                  Column('NameOfInstitution', String(256), nullable=True),
                                  Column('StudentIdentifier', String(256), nullable=True),
                                  Column('ExternalSSID', String(256), nullable=True),
                                  Column('FirstName', String(256), nullable=True),
                                  Column('MiddleName', String(256), nullable=True),
                                  Column('LastOrSurname', String(256), nullable=True),
                                  Column('Birthdate', String(256), nullable=True),
                                  Column('Sex', String(256), nullable=True),
                                  Column('GradeLevelWhenAssessed', String(256), nullable=True),
                                  Column('Group1Id', String(256), nullable=True),
                                  Column('Group1Text', String(256), nullable=True),
                                  Column('Group2Id', String(256), nullable=True),
                                  Column('Group2Text', String(256), nullable=True),
                                  Column('HispanicOrLatinoEthnicity', String(256), nullable=True),
                                  Column('AmericanIndianOrAlaskaNative', String(256), nullable=True),
                                  Column('Asian', String(256), nullable=True),
                                  Column('BlackOrAfricanAmerican', String(256), nullable=True),
                                  Column('NativeHawaiianOrOtherPacificIslander', String(256), nullable=True),
                                  Column('White', String(256), nullable=True),
                                  Column('DemographicRaceTwoOrMoreRaces', String(256), nullable=True),
                                  Column('IDEAIndicator', String(256), nullable=True),
                                  Column('LEPStatus', String(256), nullable=True),
                                  Column('Section504Status', String(256), nullable=True),
                                  Column('EconomicDisadvantageStatus', String(256), nullable=True),
                                  Column('MigrantStatus', String(256), nullable=True),
                                  Column('AssessmentAdministrationFinishDate', String(256), nullable=True),
                                  Column('AssessmentSubtestResultScoreValue', String(256), nullable=True),
                                  Column('AssessmentSubtestMinimumValue', String(256), nullable=True),
                                  Column('AssessmentSubtestMaximumValue', String(256), nullable=True),
                                  Column('AssessmentPerformanceLevelIdentifier', String(256), nullable=True),
                                  Column('AssessmentSubtestResultScoreClaim1Value', String(256), nullable=True),
                                  Column('AssessmentSubtestClaim1MinimumValue', String(256), nullable=True),
                                  Column('AssessmentSubtestClaim1MaximumValue', String(256), nullable=True),
                                  Column('AssessmentSubtestClaim1PerformanceLevelIdentifier', String(256), nullable=True),
                                  Column('AssessmentSubtestResultScoreClaim2Value', String(256), nullable=True),
                                  Column('AssessmentSubtestClaim2MinimumValue', String(256), nullable=True),
                                  Column('AssessmentSubtestClaim2MaximumValue', String(256), nullable=True),
                                  Column('AssessmentSubtestClaim2PerformanceLevelIdentifier', String(256), nullable=True),
                                  Column('AssessmentSubtestResultScoreClaim3Value', String(256), nullable=True),
                                  Column('AssessmentSubtestClaim3MinimumValue', String(256), nullable=True),
                                  Column('AssessmentSubtestClaim3MaximumValue', String(256), nullable=True),
                                  Column('AssessmentSubtestClaim3PerformanceLevelIdentifier', String(256), nullable=True),
                                  Column('AssessmentSubtestResultScoreClaim4Value', String(256), nullable=True),
                                  Column('AssessmentSubtestClaim4MinimumValue', String(256), nullable=True),
                                  Column('AssessmentSubtestClaim4MaximumValue', String(256), nullable=True),
                                  Column('AssessmentSubtestClaim4PerformanceLevelIdentifier', String(256), nullable=True),
                                  Column('AssessmentType', String(256), nullable=True),
                                  Column('AssessmentAcademicSubject', String(256), nullable=True),
                                  Column('AssessmentYear', String(256), nullable=True),
                                  Column('created_date', TIMESTAMP, nullable=False, server_default=text('NOW()')),
                                  Column('AccommodationAmericanSignLanguage', String(256), nullable=False),
                                  Column('AccommodationSignLanguageHumanIntervention', String(256), nullable=False),
                                  Column('AccommodationBraille', String(256), nullable=False),
                                  Column('AccommodationClosedCaptioning', String(256), nullable=False),
                                  Column('AccommodationTextToSpeech', String(256), nullable=False),
                                  Column('AccommodationAbacus', String(256), nullable=False),
                                  Column('AccommodationAlternateResponseOptions', String(256), nullable=False),
                                  Column('AccommodationCalculator', String(256), nullable=False),
                                  Column('AccommodationMultiplicationTable', String(256), nullable=False),
                                  Column('AccommodationPrintOnDemand', String(256), nullable=False),
                                  Column('AccommodationReadAloud', String(256), nullable=False),
                                  Column('AccommodationScribe', String(256), nullable=False),
                                  Column('AccommodationSpeechToText', String(256), nullable=False),
                                  Column('AccommodationStreamlineMode', String(256), nullable=False),
                                  Column('guid_batch', String(256), nullable=False),
                                  )

    err_list = Table('err_list', metadata,
                     Column('record_sid', BigInteger, primary_key=True, nullable=False),
                     Column('guid_batch', String(256), primary_key=True, nullable=False),
                     Column('err_code', BigInteger, nullable=True),
                     Column('err_source', BigInteger, nullable=True),
                     Column('err_code_text', Text, nullable=True),
                     Column('err_source_text', Text, nullable=True),
                     Column('created_date', TIMESTAMP, nullable=False, server_default=text('NOW()')),
                     Column('err_input', Text, nullable=False, server_default='')
                     )

    int_sbac_asmt = Table('int_sbac_asmt', metadata,
                          Column('record_sid', BigInteger, primary_key=True),
                          Column('guid_asmt', String(50), nullable=False),
                          Column('type', String(32), nullable=False),
                          Column('period', String(32), nullable=False),
                          Column('year', SmallInteger, nullable=False),
                          Column('version', String(30), nullable=False),
                          Column('subject', String(64), nullable=True),
                          Column('score_overall_min', SmallInteger, nullable=True),
                          Column('score_overall_max', SmallInteger, nullable=True),
                          Column('name_claim_1', String(128), nullable=True),
                          Column('score_claim_1_min', SmallInteger, nullable=True),
                          Column('score_claim_1_max', SmallInteger, nullable=True),
                          Column('name_claim_2', String(128), nullable=True),
                          Column('score_claim_2_min', SmallInteger, nullable=True),
                          Column('score_claim_2_max', SmallInteger, nullable=True),
                          Column('name_claim_3', String(128), nullable=True),
                          Column('score_claim_3_min', SmallInteger, nullable=True),
                          Column('score_claim_3_max', SmallInteger, nullable=True),
                          Column('name_claim_4', String(128), nullable=True),
                          Column('score_claim_4_min', SmallInteger, nullable=True),
                          Column('score_claim_4_max', SmallInteger, nullable=True),
                          Column('asmt_claim_perf_lvl_name_1', String(128), nullable=True),
                          Column('asmt_claim_perf_lvl_name_2', String(128), nullable=True),
                          Column('asmt_claim_perf_lvl_name_3', String(128), nullable=True),
                          Column('name_perf_lvl_1', String(128), nullable=True),
                          Column('name_perf_lvl_2', String(128), nullable=True),
                          Column('name_perf_lvl_3', String(128), nullable=True),
                          Column('name_perf_lvl_4', String(128), nullable=True),
                          Column('name_perf_lvl_5', String(128), nullable=True),
                          Column('score_cut_point_1', SmallInteger, nullable=True),
                          Column('score_cut_point_2', SmallInteger, nullable=True),
                          Column('score_cut_point_3', SmallInteger, nullable=True),
                          Column('score_cut_point_4', SmallInteger, nullable=True),
                          Column('effective_date', String(8), nullable=True),
                          Column('created_date', TIMESTAMP(timezone=True), nullable=False, server_default=text('NOW()')),
                          Column('guid_batch', String(50), nullable=False),
                          )

    int_sbac_asmt_outcome = Table('int_sbac_asmt_outcome', metadata,
                                  Column('record_sid', BigInteger, primary_key=True),
                                  Column('op', String(1), server_default='C', nullable=False),
                                  Column('guid_asmt', String(50), nullable=True),
                                  Column('guid_asmt_location', String(50), nullable=True),
                                  Column('name_asmt_location', String(60), nullable=True),
                                  Column('grade_asmt', String(10), nullable=False),
                                  Column('code_state', String(2), nullable=False),
                                  Column('name_state', String(50), nullable=False),
                                  Column('guid_district', String(50), nullable=False),
                                  Column('name_district', String(60), nullable=False),
                                  Column('guid_school', String(50), nullable=False),
                                  Column('name_school', String(60), nullable=False),
                                  Column('guid_student', String(50), nullable=False),
                                  Column('external_student_id', String(50), nullable=True),
                                  Column('name_student_first', String(35), nullable=True),
                                  Column('name_student_middle', String(35), nullable=True),
                                  Column('name_student_last', String(35), nullable=True),
                                  Column('birthdate_student', String(8), nullable=True),
                                  Column('sex_student', String(10), nullable=True),
                                  Column('grade_enrolled', String(10), nullable=False),
                                  Column('group_1_id', String(50), nullable=True),
                                  Column('group_1_text', String(60), nullable=True),
                                  Column('group_2_id', String(50), nullable=True),
                                  Column('group_2_text', String(60), nullable=True),
                                  Column('dmg_eth_derived', SmallInteger, nullable=True),
                                  Column('dmg_eth_hsp', Boolean, nullable=True),
                                  Column('dmg_eth_ami', Boolean, nullable=True),
                                  Column('dmg_eth_asn', Boolean, nullable=True),
                                  Column('dmg_eth_blk', Boolean, nullable=True),
                                  Column('dmg_eth_pcf', Boolean, nullable=True),
                                  Column('dmg_eth_wht', Boolean, nullable=True),
                                  Column('dmg_eth_2om', Boolean, nullable=True),
                                  Column('dmg_prg_iep', Boolean, nullable=True),
                                  Column('dmg_prg_lep', Boolean, nullable=True),
                                  Column('dmg_prg_504', Boolean, nullable=True),
                                  Column('dmg_sts_ecd', Boolean, nullable=True),
                                  Column('dmg_sts_mig', Boolean, nullable=True),
                                  Column('date_assessed', String(8), nullable=False),
                                  Column('date_taken_day', SmallInteger, nullable=False),
                                  Column('date_taken_month', SmallInteger, nullable=False),
                                  Column('date_taken_year', SmallInteger, nullable=False),
                                  Column('score_asmt', SmallInteger, nullable=False),
                                  Column('score_asmt_min', SmallInteger, nullable=False),
                                  Column('score_asmt_max', SmallInteger, nullable=False),
                                  Column('score_perf_level', SmallInteger, nullable=False),
                                  Column('score_claim_1', SmallInteger, nullable=True),
                                  Column('score_claim_1_min', SmallInteger, nullable=True),
                                  Column('score_claim_1_max', SmallInteger, nullable=True),
                                  Column('asmt_claim_1_perf_lvl', SmallInteger, nullable=True),
                                  Column('score_claim_2', SmallInteger, nullable=True),
                                  Column('score_claim_2_min', SmallInteger, nullable=True),
                                  Column('score_claim_2_max', SmallInteger, nullable=True),
                                  Column('asmt_claim_2_perf_lvl', SmallInteger, nullable=True),
                                  Column('score_claim_3', SmallInteger, nullable=True),
                                  Column('score_claim_3_min', SmallInteger, nullable=True),
                                  Column('score_claim_3_max', SmallInteger, nullable=True),
                                  Column('asmt_claim_3_perf_lvl', SmallInteger, nullable=True),
                                  Column('score_claim_4', SmallInteger, nullable=True),
                                  Column('score_claim_4_min', SmallInteger, nullable=True),
                                  Column('score_claim_4_max', SmallInteger, nullable=True),
                                  Column('asmt_claim_4_perf_lvl', SmallInteger, nullable=True),
                                  Column('asmt_type', String(32), nullable=False),
                                  Column('asmt_subject', String(64), nullable=False),
                                  Column('asmt_year', SmallInteger, nullable=False),
                                  Column('created_date', TIMESTAMP(timezone=True), nullable=False, server_default=text('NOW()')),
                                  Column('acc_asl_video_embed', SmallInteger, nullable=False),
                                  Column('acc_asl_human_nonembed', SmallInteger, nullable=False),
                                  Column('acc_braile_embed', SmallInteger, nullable=False),
                                  Column('acc_closed_captioning_embed', SmallInteger, nullable=False),
                                  Column('acc_text_to_speech_embed', SmallInteger, nullable=False),
                                  Column('acc_abacus_nonembed', SmallInteger, nullable=False),
                                  Column('acc_alternate_response_options_nonembed', SmallInteger, nullable=False),
                                  Column('acc_calculator_nonembed', SmallInteger, nullable=False),
                                  Column('acc_multiplication_table_nonembed', SmallInteger, nullable=False),
                                  Column('acc_print_on_demand_nonembed', SmallInteger, nullable=False),
                                  Column('acc_read_aloud_nonembed', SmallInteger, nullable=False),
                                  Column('acc_scribe_nonembed', SmallInteger, nullable=False),
                                  Column('acc_speech_to_text_nonembed', SmallInteger, nullable=False),
                                  Column('acc_streamline_mode', SmallInteger, nullable=False),
                                  Column('guid_batch', String(50), nullable=False),
                                  )

    int_sbac_stu_reg = Table('int_sbac_stu_reg', metadata,
                             Column('record_sid', BigInteger, primary_key=True),
                             Column('name_state', String(50), nullable=False),
                             Column('code_state', String(2), nullable=False),
                             Column('guid_district', String(50), nullable=False),
                             Column('name_district', String(60), nullable=False),
                             Column('guid_school', String(50), nullable=False),
                             Column('name_school', String(60), nullable=False),
                             Column('guid_student', String(50), nullable=False),
                             Column('external_ssid_student', String(50), nullable=False),
                             Column('name_student_first', String(35), nullable=True,),
                             Column('name_student_middle', String(35), nullable=True,),
                             Column('name_student_last', String(35), nullable=True,),
                             Column('birthdate_student', String(10), nullable=True,),
                             Column('sex_student', String(10), nullable=False),
                             Column('grade_enrolled', String(2), nullable=False),
                             Column('dmg_eth_hsp', Boolean, nullable=False),
                             Column('dmg_eth_ami', Boolean, nullable=False),
                             Column('dmg_eth_asn', Boolean, nullable=False),
                             Column('dmg_eth_blk', Boolean, nullable=False),
                             Column('dmg_eth_pcf', Boolean, nullable=False),
                             Column('dmg_eth_wht', Boolean, nullable=False),
                             Column('dmg_multi_race', Boolean, nullable=False),
                             Column('dmg_prg_iep', Boolean, nullable=False),
                             Column('dmg_prg_lep', Boolean, nullable=False),
                             Column('dmg_prg_504', Boolean, nullable=True,),
                             Column('dmg_sts_ecd', Boolean, nullable=False),
                             Column('dmg_sts_mig', Boolean, nullable=True,),
                             Column('code_confirm', String(50), nullable=False),
                             Column('code_language', String(3), nullable=True,),
                             Column('eng_prof_lvl', String(20), nullable=True,),
                             Column('us_school_entry_date', String(10), nullable=True,),
                             Column('lep_entry_date', String(10), nullable=True,),
                             Column('lep_exit_date', String(10), nullable=True,),
                             Column('t3_program_type', String(27), nullable=True,),
                             Column('prim_disability_type', String(3), nullable=True,),
                             Column('created_date', TIMESTAMP(timezone=True), nullable=False, server_default=text('NOW()')),
                             Column('guid_batch', String(50), nullable=False),
                             )
    Index('int_sbac_stu_reg_guid_batchx', int_sbac_stu_reg.c.guid_batch, unique=False)

    int_sbac_stu_reg_meta = Table('int_sbac_stu_reg_meta', metadata,
                                  Column('record_sid', BigInteger, primary_key=True),
                                  Column('guid_registration', String(50), nullable=False),
                                  Column('academic_year', SmallInteger, nullable=False),
                                  Column('extract_date', String(10), nullable=False),
                                  Column('test_reg_id', String(50), nullable=False),
                                  Column('created_date', TIMESTAMP(timezone=True), nullable=False, server_default=text('NOW()')),
                                  Column('guid_batch', String(36), nullable=False),
                                  )

    ref_column_mapping = Table('ref_column_mapping', metadata,
                               Column('column_map_key', BigInteger, primary_key=True),
                               Column('phase', SmallInteger, nullable=True),
                               Column('source_table', String(50), nullable=False),
                               Column('source_column', String(256), nullable=True),
                               Column('target_table', String(50), nullable=True),
                               Column('target_column', String(50), nullable=True),
                               Column('transformation_rule', String(50), nullable=True),
                               Column('stored_proc_name', String(256), nullable=True),
                               Column('stored_proc_created_date', TIMESTAMP(timezone=True), nullable=True),
                               Column('created_date', TIMESTAMP(timezone=True), server_default=text('NOW()'), nullable=False),
                               )

    sr_ref_column_mapping = Table('sr_ref_column_mapping', metadata,
                                  Column('column_map_key', BigInteger, primary_key=True),
                                  Column('phase', SmallInteger, nullable=True),
                                  Column('source_table', String(50), nullable=False),
                                  Column('source_column', String(256), nullable=True),
                                  Column('target_table', String(50), nullable=True),
                                  Column('target_column', String(50), nullable=True),
                                  Column('transformation_rule', String(50), nullable=True),
                                  Column('stored_proc_name', String(256), nullable=True),
                                  Column('stored_proc_created_date', TIMESTAMP(timezone=True), nullable=True),
                                  Column('created_date', TIMESTAMP(timezone=True), nullable=False, server_default=text('NOW()')),
                                  )

    return metadata


def generate_udl2_sequences(schema_name=None, metadata=None):
    '''
    generate_udl2_sequences returns all udl2 related sequences as a tuple.
    '''
    seq1 = Sequence(name='global_rec_seq', start=1, increment=1, schema=schema_name,
                    optional=True, quote='Global record id sequences. form 1 to 2^63 -1 on postgresql', metadata=metadata)
    return (seq1, )
