// Generated by CoffeeScript 1.4.0
(function() {
  var generate_jqplot_input, generate_seg_list, generate_ticks, get_number_of_segments;

  generate_ticks = function(json_data) {
    var bar_groups, bars, grade_groups, scope_groups;
    scope_groups = json['scope_groups'][0];
    grade_groups = scope_groups['grade_groups'][0];
    bar_groups = grade_groups['bar_groups'][0];
    return bars = bar_groups['bars'];
  };

  generate_jqplot_input = function(json_data) {
    var bar, bar_groups, bars, current_seg, grade_groups, i, scope_groups, seg_list, segs, _i, _j, _len, _ref;
    scope_groups = json_data['scope_groups'][0];
    grade_groups = scope_groups['grade_groups'][0];
    bar_groups = grade_groups['bar_groups'][0];
    bars = bar_groups['bars'];
    seg_list = generate_seg_list(bars);
    for (_i = 0, _len = bars.length; _i < _len; _i++) {
      bar = bars[_i];
      segs = bar['segments'];
      for (i = _j = 0, _ref = segs.length - 1; 0 <= _ref ? _j <= _ref : _j >= _ref; i = 0 <= _ref ? ++_j : --_j) {
        current_seg = segs[i];
        seg_list[i].push(current_seg['student_percentage']);
      }
    }
    return seg_list;
  };

  generate_seg_list = function(bars) {
    var i, num_segs, seg_list, _i, _results;
    num_segs = get_number_of_segments(bars);
    _results = [];
    for (i = _i = 1; 1 <= num_segs ? _i <= num_segs : _i >= num_segs; i = 1 <= num_segs ? ++_i : --_i) {
      _results.push(seg_list = []);
    }
    return _results;
  };

  get_number_of_segments = function(bars) {
    var bar, num_segs, _i, _len;
    try {
      num_segs = bars[0]['segments'].length;
      for (_i = 0, _len = bars.length; _i < _len; _i++) {
        bar = bars[_i];
        if (num_segs !== bar['segments'].length) {
          throw 'Different bars have different number of segments';
        }
      }
    } catch (error) {
      console.log('Malformed "bars" list, malformed "segments" list, or different number of segments');
    }
    return num_segs;
  };

  $(document).ready(function() {
    var callback, jqplot_input, plot_test;
    jqplot_input = generate_jqplot_input(json_data);
    plot_test = $.jqplot('chart_test', jqplot_input, {
      stackSeries: true,
      captureRightClick: true,
      seriesDefaults: {
        renderer: $.jqplot.BarRenderer,
        rendererOptions: {
          barMargin: 30,
          highlightMouseDown: true,
          barDirection: 'horizontal'
        },
        pointLabels: {
          show: true
        }
      },
      axes: {
        xaxis: {
          max: 100
        },
        yaxis: {
          padMin: 0,
          renderer: $.jqplot.CategoryAxisRenderer,
          ticks: ['School 1', 'School 2', 'School 3']
        }
      },
      legend: {
        show: false,
        location: 'e',
        placement: 'outside'
      }
    });
    callback = function(ev, seriesIndex, pointIndex, data) {
      return $('#info').html('series: ' + seriesIndex + ', point: ' + pointIndex + ', data: ' + data);
    };
    $('#chart').bind('jqplotDataClick', callback);
    return $('#chart_test').bind('jqplotDataClick', callback);
  });

}).call(this);
